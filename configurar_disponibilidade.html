<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configuração de Agenda - Clínica Estética</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  <link rel="stylesheet" href="consultar_disp.css">
</head>
<body>
  <h1>Configuração de Agenda - Clínica Estética</h1>
  <div class="container">
    <div class="controls">
      <h2>Disponibilidade</h2>
      <label>Dia da semana:</label>
      <select id="diaSemanaDisponibilidade">
        <option value="1">Segunda-feira</option>
        <option value="2">Terça-feira</option>
        <option value="3">Quarta-feira</option>
        <option value="4">Quinta-feira</option>
        <option value="5">Sexta-feira</option>
        <option value="6">Sábado</option>
      </select>
      <label>Hora Início:</label>
      <input type="time" id="horaInicioDisponibilidade">
      <label>Hora Fim:</label>
      <input type="time" id="horaFimDisponibilidade">
      <button onclick="addDisponibilidade()">Adicionar/Alterar</button>

      <h2>Intervalo Fixo</h2>
      <label>Dia da semana:</label>
      <select id="diaSemanaIntervalo">
        <option value="1">Segunda-feira</option>
        <option value="2">Terça-feira</option>
        <option value="3">Quarta-feira</option>
        <option value="4">Quinta-feira</option>
        <option value="5">Sexta-feira</option>
        <option value="6">Sábado</option>
      </select>
      <label>Hora Início:</label>
      <input type="time" id="horaInicioIntervalo">
      <label>Hora Fim:</label>
      <input type="time" id="horaFimIntervalo">
      <button onclick="addIntervalo()">Adicionar/Alterar</button>

      <h2>Exceções</h2>
      <label>Data:</label>
      <input type="date" id="dataExcecao">
      <label>Hora Início (opcional):</label>
      <input type="time" id="horaInicioExcecao">
      <label>Hora Fim (opcional):</label>
      <input type="time" id="horaFimExcecao">
      <button onclick="addExcecao()">Adicionar Exceção</button>
    </div>
    <div id="calendar"></div>
  </div>

  <script>
    let disponibilidades = [];
    let intervalos = [];
    let excecoes = [];

    document.addEventListener('DOMContentLoaded', function() {
      window.calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
        initialView: 'timeGridWeek',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        locale: 'pt-br',
        editable: true,
        selectable: true,
        eventClick: function(info) {
          if(info.event.extendedProps.tipo === 'excecao'){
            if(confirm('Deseja excluir esta exceção?')){
              excecoes = excecoes.filter(e => e.id !== info.event.id);
              info.event.remove();
              atualizarEventos();
            }
          }
        },
        events: []
      });
      window.calendar.render();
    });

    function atualizarEventos(){
      window.calendar.removeAllEvents();

      
      disponibilidades.forEach(d => {
        let dia = parseInt(d.diaSemana);
       
        let excecaoNoDia = excecoes.some(e => new Date(e.data).getDay() === dia);
        if(!excecaoNoDia){
          window.calendar.addEvent({
            daysOfWeek:[dia],
            startTime:d.inicio,
            endTime:d.fim,
            title:'Disponível',
            className:'disponibilidade',
            tipo:'disponibilidade'
          });
        }
      });

    
      intervalos.forEach(i => {
        let dia = parseInt(i.diaSemana);
        window.calendar.addEvent({
          daysOfWeek:[dia],
          startTime:i.inicio,
          endTime:i.fim,
          title:'Intervalo',
          className:'intervalo',
          tipo:'intervalo'
        });
      });

   
      excecoes.forEach(e => {
        window.calendar.addEvent({
          id:e.id,
          start:e.inicio ? `${e.data}T${e.inicio}` : `${e.data}T00:00`,
          end:e.fim ? `${e.data}T${e.fim}` : `${e.data}T23:59`,
          title:'Exceção',
          className:'excecao',
          tipo:'excecao'
        });
      });
    }

    function addDisponibilidade(){
      const dia = document.getElementById('diaSemanaDisponibilidade').value;
      const inicio = document.getElementById('horaInicioDisponibilidade').value;
      const fim = document.getElementById('horaFimDisponibilidade').value;
      if(!inicio || !fim) return alert('Preencha horários.');
     
      disponibilidades = disponibilidades.filter(d => d.diaSemana !== dia);
      disponibilidades.push({diaSemana:dia,inicio:inicio,fim:fim});
      atualizarEventos();
    }

    function addIntervalo(){
      const dia = document.getElementById('diaSemanaIntervalo').value;
      const inicio = document.getElementById('horaInicioIntervalo').value;
      const fim = document.getElementById('horaFimIntervalo').value;
      if(!inicio || !fim) return alert('Preencha horários.');
    
      intervalos = intervalos.filter(i => i.diaSemana !== dia);
      intervalos.push({diaSemana:dia,inicio:inicio,fim:fim});
      atualizarEventos();
    }

    function addExcecao(){
      const data = document.getElementById('dataExcecao').value;
      const inicio = document.getElementById('horaInicioExcecao').value;
      const fim = document.getElementById('horaFimExcecao').value;
      if(!data) return alert('Selecione uma data.');
      const id = Date.now().toString();
      excecoes.push({id:id,data:data,inicio:inicio,fim:fim});
      atualizarEventos();
    }
  </script>
</body>
</html>